\section{Semantics}
Extending on the algebra over annotated 
relations presented in \cite{sen2025provsqlgeneralkeepingtrack} by 
adding a new predicate form that allows 
comparison between aggregations we fill the semantics gap that 
was noted and left for future work.
\paragraph{Setup.}
Let $(K,\oplus,\otimes,\mathbb{0}_K,\mathbb{1}_K,\delta,\ominus)$ be an m-semiring of annotations with an 
added $\delta$ operation and, $(M,+_M,\mathbb{0}_M)$ be an 
additive monoid of aggregate values. Let $*:K\times M \mapsto K$ be a scalar action of $M$ on $K$, such that for $a \in K, b \in M$, 
$a * b = a \times b \in K$.
We fix a finite set $\mathbf{X}$ of variables. Each $\mathbf{x}\in\mathbf{X}$ have provenance annotations in $K$ and values in $M$ 
given by a semimodule ($K\times M$, say $\mathcal{M}$) map 
\[
\mathfrak{Z}:\mathbf{X}\rightarrow \mathcal{M}\; \text{and} \quad \mathfrak{Z}^{(K)}(\mathbf{x})=\mathbf{x}^{(K)}, \; \mathfrak{Z}^{(M)}(\mathbf{x})=\mathbf{x}^{(M)}
\]
An aggregation $\mathdutchcal{a}$ is defined by an indicator function 
$I_\mathdutchcal{a}:\mathbf{X}\rightarrow \{0,1\}$
on variables from $\mathbf{X}$ that participate in the aggregation as 
\[
\mathdutchcal{a} = {\bigoplus_\mathcal{M}}_{\mathbf{x}\in \mathrm{supp}(\mathdutchcal{a})}(\mathbf{x}^{(K)},\mathbf{x}^{(M)})
\]
where, 
$\mathrm{supp}(\mathdutchcal{a})=\{\,\mathbf{x} \mid I_\mathdutchcal{a}(\mathbf{x})=1 \,\}$ and 
$\bigoplus_{\mathcal{M}}$ is a formal $\mathcal{M}-$sum over 
variables $\mathbf{x}$ involved in the aggregation.
A possible world is a represented by a subset $W\subseteq\mathbf{X}$.
\begin{definition}[Possible-world Semantics]\label{def:pw_semantics}
For any two aggregations $\mathdutchcal{u},\mathdutchcal{v}$, we define the comparison operator $\oslash$ at the semimodule level as, 
\[
[\mathdutchcal{u} \oslash \mathdutchcal{v}]_{\mathit{op}\in\{ =, \neq , >, <, \geq, \leq\}}:\mathcal{M} \times \mathcal{M} \rightarrow K 
\]
such that,
\begin{multline*}
[\mathdutchcal{u} \oslash \mathdutchcal{v}]_{\mathrm{op}}=
\bigoplus_{W} 
\Biggl(
  \Bigl( \bigotimes_{W\cap\mathrm{supp}(\mathdutchcal{u})} \mathbf{x}^{(K)} \Bigr) \;\otimes\; \Bigl( \bigotimes_{W\cap\mathrm{supp}(\mathdutchcal{v})} \mathbf{x}^{(K)} \Bigr)
\otimes
  \chi_{\mathrm{op}}\bigl(  {\bigplus_M}_{W\cap\mathrm{supp}(\mathdutchcal{u})} \mathbf{x}^{(M)}, {\bigplus_M}_{W\cap\mathrm{supp}(\mathdutchcal{v})} \mathbf{x}^{(M)}   \bigr)
\;\otimes\;\\
  \Biggl(\mathbb{1}_K \ominus \Biggl( \bigoplus_{(\mathbf{X}\setminus W)\cap\mathrm{supp}(\mathdutchcal{u})} \mathbf{x}^{(K)} \;\oplus\; \bigoplus_{(\mathbf{X}\setminus W)\cap\mathrm{supp}(\mathdutchcal{u})} \mathbf{x}^{(K)} \Biggr)\Biggr)
\Biggr)
\end{multline*}
where,
$\chi_{\mathrm{op}}\bigl(  {\bigplus_M}_{W\cap\mathrm{supp}(\mathdutchcal{u})} \mathbf{x}^{(M)}, {\bigplus_M}_{W\cap\mathrm{supp}(\mathdutchcal{v})} \mathbf{x}^{(M)}   \bigr)=
\begin{cases}
\mathbb{1}_K & \text{if } {\bigplus_M}_{W\cap\mathrm{supp}(\mathdutchcal{u})} \mathbf{x}^{(M)}\;\mathit{op}\;{\bigplus_M}_{W\cap\mathrm{supp}(\mathdutchcal{v})} \mathbf{x}^{(M)},\\
\mathbb{0}_K & \text{otherwise.}
\end{cases}$
\end{definition}
\paragraph{Complexity}

We show that provenance evaluation of a comparison between 
two aggregations over an additive monoid $M$, 
represented as formal $\mathcal{M}$-sums over an arbitrary 
absorptive $m-$semiring of annotations $K$, when defined by a
semimodule-level operator
$\oslash$ based on the proposed semantics is computationally hard.
While this \textsc{Aggregation-Comparison}(\textbf{AC}) produces 
a formal provenance over all possible worlds, we first define a 
suitable decision version to formalize its hardness. 
\begin{definition}[\textsc{Aggregation-Comparison-Decision} (\textbf{ACD})]
  Given two $\mathcal{M}-$aggregations $\mathdutchcal{u}$ and $\mathdutchcal{v}$ over a 
  finite set of variables $\mathbf{X}$
  the \textbf{ACD} problem asks whether there exists a possible world $W\subseteq\mathbf{X}$ such 
  that the provenance evaluation of the comparison in an additive monoid $M$ is non-zero in 
  the $m-$semiring $K$ :
\[
  [\mathdutchcal{u} \oslash \mathdutchcal{v}]_=^W\neq\mathbb{0}_{K}
  \]
\end{definition}
\begin{remark}
  $  [\mathdutchcal{u} \oslash \mathdutchcal{v}]_=^W$ follows our original semantics exactly but for a specific $W\subseteq\mathbf{X}$ without the outer disjunction over all possible worlds.
\end{remark}
The \textsc{Subset-Sum} problem is a classical NP-complete problem which we would use later in our proof. To avoid unnecessary complications we define a set-theoretic version of the \textsc{Subset-Sum} problem which is also NP-complete. 
\begin{definition}[\textsc{Subset-Sum}]
  Given a finite set $S\subset\mathbb{Z}_{\geq 0}$ and a target sum $P\in\mathbb{Z}_{\geq 0}$ does 
  there exist $S'\subseteq S$ such that $\sum_{s\in S'}s=P$ ?
\end{definition}
\begin{theorem}\label{th:ACD_NP}
  \textbf{ACD} is NP-complete.
\end{theorem}
\begin{proof}
W.l.o.g. we specialise \textbf{ACD} over $(\mathbb{Z}_{\geq 0},+,\cdot)$ and the free $m-$semiring of polynomials 
$\mathbb{N}[\mathbf{X}]$.
\paragraph{\textbf{ACD}$\in$NP.}
Let $W\subseteq\mathbf{X}$ be a candidate solution. We verify in polynomial time whether 
  $[\mathdutchcal{u} \oslash \mathdutchcal{v}]_=^W\neq0$.\\
${\bigplus_{\mathbb{Z}_{\geq 0}}}_{W\cap\mathrm{supp}(\mathdutchcal{u})} \mathbf{x}^{(\mathbb{Z}_{\geq 0})}\text{ and }{\bigplus_{\mathbb{Z}{\geq 0}}}_{W\cap\mathrm{supp}(\mathdutchcal{v})} \mathbf{x}^{(\mathbb{Z}{\geq 0})}$ can be computed in polynomial time.
Then, $\chi_=$ is just a boolean check over these computed sums. 
Further, we compute the provenance annotations in $\mathbb{N}[X]$ and all these steps 
are polynomial-time in the size of our constructed instance, so \textbf{ACD}$\in$NP.
\paragraph{ACD is NP-hard.}
We reduce an instance of \textsc{Subset-Sum} to an \textbf{ACD}-instance in polynomial time.\\
We construct $\mathbf{X}^*$ from $\mathbf{X}$ by ensuring that for each $s\in S$ we include a $\mathbf{x}\in\mathbf{X}$ for which 
  $\mathfrak{Z}^{(\mathbb{Z}_{\geq 0})}(\mathbf{x})=s$. We also inlude in $\mathbf{X}^*$ an $\mathbf{x}\in\mathbf{X}$ such that 
  $\mathfrak{Z}^{(\mathbb{Z}_{\geq 0})}(\mathbf{x})=P$. Hence, $|\mathbf{X}^*|=|S|+1$.\\
  We further define two aggregates $\mathdutchcal{u}$ and $\mathdutchcal{v}$ with $\mathrm{supp}(\mathdutchcal{u})=\{\mathbf{x}\in\mathbf{X}^*\mid\mathfrak{Z}^{(\mathbb{Z}_{\geq 0})}(\mathbf{x})=s\}$ and $\mathrm{supp}(\mathdutchcal{v})=\{\mathbf{x}\in\mathbf{X}^*\mid\mathfrak{Z}^{(\mathbb{Z}_{\geq 0})}(\mathbf{x})=P\}$, respectively.
  $[\mathdutchcal{u}\oslash\mathdutchcal{v}]_=$ is computed using semiring 
  operations in a free $\mathbb{N}[\mathbf{X}]$ over provenance 
  annotations decided by a valuation $\mathfrak{Z}^{(\mathbb{N}[\mathbf{X}])}$ 
  and any $W\subseteq\mathbf{X}^*$ will always result in syntactic 
  non-zero polynomial summands in  $[\mathdutchcal{u}\oslash\mathdutchcal{v}]_=$  
  unless $\chi_==0$. $[\mathdutchcal{u}\oslash\mathdutchcal{v}]_=$
evaluates to a nonzero element of $\mathbb{N}[\mathbf{X}]$
iff there exists a $S'\subseteq S$ whose elements sum to $P$.
  In other words, a \textbf{YES}-instance of \textsc{Subset-Sum} will only always reduce to an \textbf{ACD} \textbf{YES}-instance and a \textbf{NO}-instance 
  of \textsc{Subset-Sum} will only always reduce to a \textbf{NO}-instance of \textbf{ACD}. This reduction, clearly, is in polynomial time in $|S|+1$ and hence 
  \textbf{ACD} is NP-hard.
\paragraph{NP-completeness}
From NP membership and hardness, \textbf{ACD} is NP-complete.
\end{proof}

\begin{remark}[On generality]
Our reduction is carried out in $\mathbb{N}[\mathbf{X}]$. And by its universal property, for any arbitrary m-semiring $K$ 
  and valuation $\mathfrak{Z}^{(K)}$, $\exists$ a unique homomorphism $\mathcal{E}_{\mathfrak{Z}^{(K)}}:\mathbb{N}[\mathbf{X}]\rightarrow K$. Hardness can be transferred 
  to any arbitrary m-semiring $K$ for which one can choose a semiring valuation $\mathfrak{Z}^{(K)}$ that preserves non-zeroness of the provenance summands in the reduction.
\end{remark}
We now define a counting version of the \textsc{Subset-Sum} problem, which is a known \#P-complete problem.
\begin{definition}[\#\textsc{Subset-Sum}]
  Given a finite set $S\subset\mathbb{Z}_{\geq 0}$ and a target sum $P\in\mathbb{Z}_{\geq 0}$, count the number of subsets $S'\subseteq S$ such that $\sum_{s\in S'}s = P$.
\end{definition}
\begin{theorem}
  \#\textbf{AC} is $\#$\textbf{P}-hard.
\end{theorem}
\begin{proof}
  W.l.o.g, over $\mathbb{N}[\mathbf{X}]$ and $(\mathbb{Z}_{\geq 0},+,\cdot)$ \textbf{AC} enumerates all possible worlds where the aggregate comparison is satisfied. 
  We consider a counting version of \textbf{AC}, say \#\textbf{AC}, that simply counts the number of satisfying possible worlds.
  For each subset that is to be checked for equality in \#\textsc{Subset-Sum}, it is easy to reduce the candidate instances into an \#\textbf{AC} instance, 
  using the the same construction as defined in the proof of Theorem~\ref{th:ACD_NP}.\\
  And consequently, there exists a bijection between subsets $S'\subseteq S$ with $\sum_{s\in S'} s =P$ and possible worlds $W$ that yields a non-zero provenance summand in $\mathbb{N}[\textbf{X}]$ thus contributing to the \textit{count} in \#\textbf{AC}. 
  Therefore, the output of \#\textbf{AC} equals the number of solutions to the \#\textsc{Subset-Sum} problem. And since  \#\textsc{Subset-Sum} is \#P-complete, \#\text{AC} is \#P-hard. 
\end{proof}
\begin{corollary}
  \textbf{AC} is $\#$\textbf{P}-hard and in the worst case explicit size of $[\mathdutchcal{u}\oslash\mathdutchcal{v}]_=$ is exponential in input size.
\end{corollary}
\begin{proof}
  Since \#\textbf{AC} is just a counting version of \textbf{AC}, \textbf{AC} is at least as hard as \#\textbf{AC}. Therefore, \textbf{AC} is \#P-hard. \\
  For every world \(W\subseteq\mathbf{X}\) we have
  \(W\cap\mathrm{supp}(\mathdutchcal{u})=|W|\ge0\), and
  \(\chi_= = \mathbb{1}_K\) for every good \(W\); therefore each world contributes the monomial
  \(\prod_{\textbf{x}\in W} x^{(K)}\). The outer disjunction over possible worlds expands to \(\prod_\mathbf{X}(1+\mathbf{x})\), which
  contains exactly \(2^{|\mathbf{X}|}\) distinct monomials. The input size
  of the constructed instance is \(O(|\mathbf{X}|)\),
  hence any explicit sum-of-monomials representation of the provenance must be of size
  \(\Omega(2^{|\mathbf{X}|})\).

\end{proof}

\begin{proposition}\label{prop:j_rewrite}
All queries with $\mathsf{HAVING\; COUNT(*)\;\textit{op}\; c}$ as predicate(s), where $\textit{op}\;\in\{=,<,>,\leq,\geq\}$, can be rewritten as equivalent \textsc{JOIN}-based queries for which semiring-provenance can be computed using our semantics in \cite{sen2025provsqlgeneralkeepingtrack} as:
\begin{enumerate}
\item
\[
\bigoplus_{W,|W| = c} 
\Biggl(
  \bigotimes_{W\cap\mathrm{supp}(\mathdutchcal{u})} \mathbf{x}^{(K)} \Biggr)
   \ominus \bigoplus_{W,|W| = c+1} 
\Biggl(
  \bigotimes_{W\cap\mathrm{supp}(\mathdutchcal{u})} \mathbf{x}^{(K)} \Biggr)
  \text{ when } op\;=\;= \], 
\item \[
  \bigoplus_{X} \mathbf{x}^{(K)} \ominus \biggl(\bigoplus_{W, |W|=c}\bigotimes \mathbf{x}^{(K)}\biggr)\;\text{when}\;op=\;<
\]
\item 
\[
\bigoplus_{W,|W| = c} 
\Biggl(
  \bigotimes_{W\cap\mathrm{supp}(\mathdutchcal{u})} \mathbf{x}^{(K)} \Biggr)\;\text{when}\;op\;=\;>
\]

\end{enumerate}

\end{proposition}


\begin{theorem}
  For any commutative $m-$semiring K (satisfying (A9)--(A12)) that is additively 
  idempotent, provenance of any predicate of the form \textsc{HAVING COUNT(*) }$op\;c$ evaluated using the possible-world 
  semantics of Definition~\ref{def:pw_semantics} is equivalent to the corresponding provenance computation of the \textsc{JOIN}-based rewrites described in Proposition~\ref{prop:j_rewrite}.
\end{theorem}
\begin{proof}[Proof]
\begin{proof}
Assume axioms A9--A12, together with
\[
\textbf{A13:}\qquad a\otimes(b\ominus c)=a\otimes b\;\ominus\; a\otimes c,
\qquad
\textbf{A14:}\qquad (a\oplus b)\ominus c = (a\ominus c)\oplus(b\ominus c).
\]

Let $U:=\mathrm{supp}(\textsc{COUNT(*)})$. For any $W\subseteq U$ define the monomial
\[
A_W := \bigotimes_{x\in W}\mathbf{x}^{(K)},
\]
and for $|W|=c$ define the ``exact-$W$'' contribution
\[
t_W := A_W \otimes \Bigl(\mathbb{1}_K \ominus \bigoplus_{x\in U\setminus W}\mathbf{x}^{(K)}\Bigr).
\]
Put
\[
S_c := \bigoplus_{\substack{W\subseteq U\\|W|=c}} A_W,\qquad
S_{c+1} := \bigoplus_{\substack{W'\subseteq U\\|W'|=c+1}} A_{W'},
\qquad
\bigl[\textsc{COUNT(*)}\oslash c\bigr]_{=}
   := \bigoplus_{\substack{W\subseteq U\\|W|=c}} t_W.
\]

\paragraph{Induction: A14 distributes over any finite $\oplus$-sum.}
We first prove by induction on $n\ge 1$ the identity
\[
\Bigl(\bigoplus_{i=1}^n a_i\Bigr)\ominus c
   = \bigoplus_{i=1}^n (a_i\ominus c),
\tag{I}
\]
for arbitrary $a_1,\dots,a_n,c\in K$.

Base $n=1$ is trivial. For $n=2$ this is exactly A14:
\[
(a_1\oplus a_2)\ominus c = (a_1\ominus c)\oplus(a_2\ominus c).
\]
Assume (I) holds for $n-1$. Then
\[
\begin{aligned}
\Bigl(\bigoplus_{i=1}^n a_i\Bigr)\ominus c
&= \Bigl(\bigl(\bigoplus_{i=1}^{\,n-1} a_i\bigr)\oplus a_n\Bigr)\ominus c \\
&\overset{\text{A14}}{=}
\Bigl(\bigoplus_{i=1}^{\,n-1} a_i\Bigr)\ominus c \;\oplus\; (a_n\ominus c) \\
&\overset{\text{IH}}{=}
\bigoplus_{i=1}^{\,n-1} (a_i\ominus c) \;\oplus\; (a_n\ominus c)
= \bigoplus_{i=1}^n (a_i\ominus c).
\end{aligned}
\]
Thus (I) holds for every finite $n$.

\paragraph{Algebraic derivation.}
Using the induction result (I) with the outer sum in $S_c$ and $c:=S_{c+1}$ we obtain
\[
S_c\ominus S_{c+1}
= \Bigl(\bigoplus_{|W|=c} A_W\Bigr)\ominus S_{c+1}
= \bigoplus_{|W|=c} \bigl(A_W\ominus S_{c+1}\bigr).
\tag{1}
\]
\end{proof}
%  peoceed by establishing a monus structure of an arbitrary $m-$semiring $K$, that we will use to manipulate 
% algebraic expressions involving $\ominus$, in this proof.\\
% $K$ satisfies $(A9)-(A12)$.
%   Therefore $\forall\;a,b,c \in K$, \[a-b\leq c\;\iff\;a\leq b+c\]
%   where, $\leq$ is induced by the monoid law:\[a\leq b\;\iff\;\exists c \; \text{s.t}\; a +c=b\] 
%   Since $K$ is idempotent over semiring addition, this ordr is a semilattice order: $a\leq b\iff a\oplus b=b$ and $a\ominus b$ is the residual difference satisfying:
%   \[a\leq b\oplus c\;\iff\;a\ominus b\leq c\tag{\S}\]\\
%   If $op$ is $=$,\\
% Let $U=\mathrm{supp}(\textsc{COUNT(*)})$ and for $T\subseteq U$ set
% $A_T=\bigotimes_{x\in T}\mathbf{x}^{(K)}$ as before. Put
% \[
% S_c=\bigoplus_{|T|=c} A_T,\qquad S_{c+1}=\bigoplus_{|T|=c+1} A_T,
% \]
% and write the possible-world sum (restricted to contributing worlds)
% \[
% [\textsc{COUNT(*)} \oslash c]_{=}=\bigoplus_{\substack{W\subseteq\mathbf X\\|W\cap U|=c}}
% A_{W\cap U}\otimes\Bigl(\mathbb{1}_K\ominus\bigoplus_{x\in U\setminus(W\cap U)}\mathbf{x}^{(K)}\Bigr).
% \]
%
% We prove \( [\textsc{COUNT(*)} \oslash c]_{=}=S_c\ominus S_{c+1}\) by showing the two inequalities
% \[
% \ [\textsc{COUNT(*)} \oslash c]_{=}\leq S_c\ominus S_{c+1},\qquad S_c\ominus S_{c+1}\le  [\textsc{COUNT(*)} \oslash c]_{=}.
% \]
%
% \paragraph{(i) $ [\mathrm{COUNT(*)} \oslash c]_{=}\le S_c\ominus S_{c+1}$.}
% By the residual difference property $(\S)$ it suffices to prove
% \[
% \ [\textsc{COUNT(*)} \oslash c]_{=}\oplus S_{c+1}\le S_c.
% \]
% Fix a particular $T\subseteq U$ with $|T|=c$ and denote
% \[
% t_T := A_T\otimes\Bigl(\mathbb{1}_K\ominus\bigoplus_{x\in U\setminus T}\mathbf{x}^{(K)}\Bigr).
% \]
% We show \(t_T\oplus S_{c+1}\le S_c\). Every generator (summand) of
% \(t_T\oplus S_{c+1}\) is of the form $A_{T'}$ for some $T'$ with $|T'|\ge c$:
% - the summands coming from $S_{c+1}$ are by definition $A_{T'}$ with $|T'|=c+1$;
% - the nested subtraction factor in $t_T$ guarantees that any multiplicative extension of $A_T$ (i.e. $A_{T\cup S}$ with $S\neq\emptyset$) is removed from the contribution of $t_T$, so the only remaining atomic contribution from $t_T$ that survives as a generator is $A_T$ itself.
%
% Thus every generator of \(t_T\oplus S_{c+1}\) is a generator of the larger sum
% \(\bigoplus_{|T'|\ge c} A_{T'}\). Since \(S_c=\bigoplus_{|T|=c}A_T\) and idempotent
% addition orders generators by set-inclusion, 
% we therefore have \(t_T\oplus S_{c+1}\le S_c\). Summing over all \(T\) with \(|T|=c\)
%   yields \( [\textsc{COUNT(*)} \oslash c]_{=}\oplus S_{c+1}\le S_c\), hence \( [\textsc{COUNT(*)} \oslash c]_{=}\le S_c\ominus S_{c+1}\)
% by $(\S)$.
%
% \paragraph{(ii) $S_c\ominus S_{c+1}\le  [\mathrm{COUNT(*)} \oslash c]_{=}$.}
% Again using $\S$: it suffices to show
% \[
% S_c \le S_{c+1}\oplus  [\textsc{COUNT(*)} \oslash c]_{=}.
% \]
% Every generator $A_T$ with $|T|=c$ appears in the right-hand side because
% \[
% A_T = A_T\otimes\Bigl(\mathbb{1}_K\ominus\bigoplus_{x\in U\setminus T}\mathbf{x}^{(K)}\Bigr)
% \oplus
% \bigoplus_{\substack{S\subseteq U\setminus T\\|S|\ge 1}} A_{T\cup S},
% \]
% the left summand being exactly the $t_T$-term in $ [\textsc{COUNT(*)} \oslash c]_{=}$ and the right summand
% contained in $S_{c+1}\oplus S_{c+2}\oplus\cdots$. Therefore each
% $A_T\le S_{c+1}\oplus [\textsc{COUNT(*)} \oslash c]_{=}$, and taking the $\oplus$ of these inequalities
% over all $T$ with $|T|=c$ yields \(S_c\le S_{c+1}\oplus [\textsc{COUNT(*)} \oslash c]_{=}\).
% Using $(\dagger)$ we deduce \(S_c\ominus S_{c+1}\le  [\textsc{COUNT(*)} \oslash c]_{=}\).
%
% Combining (i) and (ii) gives the equality \( [\textsc{COUNT(*)} \oslash c]_{=}=S_c\ominus S_{c+1}\). This completes the proof.
\end{proof}

\begin{toappendix}
    The resudual property $\S$ relies only on additive monus axioms A9--A12.
    \begin{itemize}
        \item A9: \(a - a = 0\)
        \item A10: \(0 - a = 0\)
        \item A11: \(a+(b-a) = b + (a-b)\)
        \item A12: \(a-(b+c) = (a - b) - c\)
    \end{itemize}
    \paragraph{Idempotence.} \(a+a = a\)\\
    From these we can establish a semilattice order: \(x\leq y\; \iff \; x+y = y\).
    By A11, \(a = (a \ominus b) \oplus (a \land b)\). If \(a\ominus b\leq c\), by definition of \(\leq\), \((a\ominus b) \oplus c = c\).
    From A11, \(a = b \oplus (a\ominus b)\leq b \oplus c\) because \((a\ominus b) \leq c\).\\
    Conversely, if \(a\leq b \oplus c\), then \((a \ominus b) \leq (b \oplus c) \ominus b \). Using A12, 
    \((b \oplus c) \ominus b = c\). Hence, \(a\ominus b \leq c\).\\
    Thus, the residual property \(\S\) of monus follows directly from axioms A9--A12, and idempotence of \(\oplus\)
    Commutative multiplication is a necessity.
\end{toappendix}
% \subsection{Possible-world semantics - a lazy approach}
% \paragraph{Semantic Partitioning of Variables}

% Let $\mathbf{X}$ be the universe of variables (tuples). Fix a set of attribute(s) $A$ that define semantic similarity. Let
% $\phi^A: \mathbf{X} \to \mathbb{R}^d$
% be a deterministic feature/extraction map that transforms each tuple $\mathbf{x} \in \mathbf{X}$ into a $d$-dimensional representation. Let
% $g: \mathbb{R}^d \to \{1, \dots, m\}$
% be a deterministic clustering. We define a map for assigning blocks from a finite collection $\mathcal{B}$ as,
% \[
% \kappa: \mathbf{X} \to \mathcal{B} = \{B_1, \dots, B_m\}, \quad \kappa(\mathbf{x}) = B_{g(\phi^A(\mathbf{x}))}
% \]
% The semantic partition induced by $\kappa$ is the family $\mathcal{B} = \{B_j\}_{j=1}^m$ with
% \[
% B_j = \{\mathbf{x} \in \mathbf{X} \mid \kappa(\mathbf{x}) = B_j \}
% \]
% We require that $\{B_j\}$ forms a partition of $\mathbf{X}$, i.e.,
% \[
% \bigcup_{j=1}^{m} B_j = \mathbf{X}, \quad B_i \cap B_j = \emptyset \text{ for } i \neq j
% \]
% \color{red}
% \paragraph{Choices for $\phi^A$ and $g$ (From related works on clustering)}

% \begin{itemize}
%     \item \textbf{Numeric attributes:} 
%         \begin{itemize}
%             \item $\phi(x)$: normalized numeric vector (z-score or min--max). 
%             \item Similarity metric: Euclidean or Mahalanobis. 
%             \item $g$: k-means or mini-batch k-means for scalability.
%         \end{itemize}
%     \item \textbf{Categorical attributes:} 
%         \begin{itemize}
%             \item Encode with learned embeddings or frequency/one-hot $\to \phi(x)$.
%             \item Similarity metric: cosine similarity.
%             \item $g$: k-means on embedding space or hierarchical clustering.
%         \end{itemize}
%     \item \textbf{Text attributes:} 
%         \begin{itemize}
%             \item Use sentence or attribute embeddings (e.g., Sentence-BERT, transformer CLS) $\to \phi(x)$.
%             \item Similarity metric: cosine similarity.
%             \item $g$: k-means or HDBSCAN for variable-sized clusters.
%         \end{itemize}
%     \item \textbf{Large-scale / approximate nearest neighbors:} 
%         \begin{itemize}
%             \item Use LSH or Faiss for embeddings, letting $g$ assign LSH buckets or ANN clusters.
%         \end{itemize}
%     \item \textbf{Threshold-based semantics:} 
%         \begin{itemize}
%             \item Use DBSCAN with distance threshold $\varepsilon$ so that dense semantic neighborhoods become blocks; outliers form singletons.
%         \end{itemize}
% \end{itemize}
% \color{black}
% \noindent Ensure that the choice of metric and $g$ makes $\kappa$ deterministic (e.g., fixed initialization / random seed) to preserve reproducibility.

% \begin{proposition}[Block-world mapping and lifted block-level possible-world semantics]
% Let
%   $\mathcal{B} = \{B_1,\dots,B_m\}$ be a collection of blocks disjointly partioning $\mathbf{X}$ such that
% \[
% \bigcup_{k=1}^m B_k = \mathbf{X}
% \qquad\text{,}\qquad
% B_i\cap B_j=\varnothing\ \text{for }i\neq j,
% \]
%   and $\mathbf{X}_b:=\mathcal{B}$ is the analog of $\mathbf{X}$ but for blocks.

% Then for a mapping defined as, 
% \[
% f:\mathcal{P}(\mathbf{X})\longrightarrow \mathcal{P}(\mathbf{X}_b),\qquad
% f(W):=\{\,B\in\mathbf{X}_b \mid B\cap W\neq\varnothing\,\},
% \]
% which sends each tuple-level possible world $W\subseteq\mathbf{X}$ to the
% set $W_b\subseteq\mathbf{X}_b$ of blocks that contain at least one tuple of $W$:
% \begin{enumerate}
%   \item For every $W\subseteq\mathbf{X}$ the image $W_b=f(W)$ is \emph{unique}.
%   \item The mapping $f$ induces a partition of the tuple-level worlds:
%     for every $V\subseteq\mathbf{X}_b$,
%     \[
%       \mathcal{W}_V := \{\,W\subseteq\mathbf{X}\mid f(W)=V\,\}
%     \]
%     is the (possibly empty) fibre of $V$, and the family $\{\mathcal{W}_V\}_{V\subseteq\mathbf{X}_b}$
%     is a partition of $\mathcal{P}(\mathbf{X})$.
%   \item (Lifting of semantics) Let $(K,\oplus,\otimes,\mathbb{0}_K,\mathbb{1}_K,\delta,\ominus)$
%     be the same $m$-semiring as in the tuple-level semantics, let $(M,+_M,\mathbb{0}_M)$ be the additive monoid of aggregate values,
%     and let $\mathdutchcal{u},\mathdutchcal{v}$ be two aggregations defined over $\mathbf{X}$ as in the tuple-level setup. Define for each block
%     $B\in\mathbf{X}_b$ the \emph{block-level} annotations and values by
%     \[
%       \mathbf{x}_B^{(K)} \;=\; \bigoplus_{\mathbf{x}\in B} \mathbf{x}^{(K)}
%       \qquad\text{and}\qquad
%       \mathbf{x}_B^{(M)} \;=\; \bigplus_{M,\;\mathbf{x}\in B} \mathbf{x}^{(M)},
%     \]
%     and let $\widehat{\mathdutchcal{u}},\widehat{\mathdutchcal{v}}$ be the induced aggregations on $\mathbf{X}_b$
%     (i.e. they include exactly those blocks that contain some original variables in the supports of $\mathdutchcal{u},\mathdutchcal{v}$ respectively).
%     Then the tuple-level possible-world comparison
%     $[\mathdutchcal{u}\oslash\mathdutchcal{v}]_{\mathrm{op}}$ equals the block-level expression obtained by summing, for each block-world $V\subseteq\mathbf{X}_b$, the contributions of all tuple-worlds mapping to $V$:
%     \[
%       [\mathdutchcal{u}\oslash\mathdutchcal{v}]_{\mathrm{op}}
%       \;=\;
%       \bigoplus_{V\subseteq\mathbf{X}_b}
%         \Biggl(
%           \bigoplus_{W\in\mathcal{W}_V}
%             \Bigl(
%               \bigotimes_{W\cap\mathrm{supp}(\mathdutchcal{u})}\mathbf{x}^{(K)}
%               \;\otimes\;
%               \bigotimes_{W\cap\mathrm{supp}(\mathdutchcal{v})}\mathbf{x}^{(K)}
%               \;\otimes\;
%               \chi_{\mathrm{op}}\!\Bigl(\bigplus_{M,W\cap\mathrm{supp}(\mathdutchcal{u})}\mathbf{x}^{(M)},
%                                       \bigplus_{M,W\cap\mathrm{supp}(\mathdutchcal{v})}\mathbf{x}^{(M)}\Bigr)
%               \;\otimes\;
%               \Phi_{W}
%             \Bigr)
%         \Biggr),
%     \]
%     where $\Phi_{W}$ denotes the ``outside-world mask'' factor appearing in the tuple-level semantics
%     (the factor involving $\ominus$ in the original definition), and, equivalently, one may rewrite the inner sum
%     in terms of block-level annotations as
%     \[
%       [\mathdutchcal{u}\oslash\mathdutchcal{v}]_{\mathrm{op}}
%       \;=\;
%       \bigoplus_{V\subseteq\mathbf{X}_b}
%         \Biggl(
%           \Bigl(\!\bigotimes_{B\in V\cap\mathrm{supp}(\widehat{\mathdutchcal{u}})} \mathbf{x}_B^{(K)}\Bigr)
%           \otimes
%           \Bigl(\!\bigotimes_{B\in V\cap\mathrm{supp}(\widehat{\mathdutchcal{v}})} \mathbf{x}_B^{(K)}\Bigr)
%           \otimes
%           \widehat{\chi}_{\mathrm{op}}\!\Bigl(\bigplus_{M,B\in V\cap\mathrm{supp}(\widehat{\mathdutchcal{u}})}\mathbf{x}_B^{(M)},
%                                           \bigplus_{M,B\in V\cap\mathrm{supp}(\widehat{\mathdutchcal{v}})}\mathbf{x}_B^{(M)}\Bigr)
%           \otimes
%           \widehat{\Phi}_{V}
%         \Biggr),
%     \]
%     where $\widehat{\chi}_{\mathrm{op}}$ and $\widehat{\Phi}_{V}$ are the natural block-level counterparts of $\chi_{\mathrm{op}}$ and $\Phi_{W}$.
% \end{enumerate}
% \end{proposition}

% \begin{proof}
% \begin{enumerate}
% \item \textbf{Uniqueness of the image.}
% The mapping $f$ is defined deterministically: given a tuple-world $W\subseteq\mathbf{X}$,
% the set $f(W)=\{B\in\mathbf{X}_b\mid B\cap W\neq\varnothing\}$ is a well-defined subset of $\mathbf{X}_b$.
% Because $f$ is a function (each input $W$ is assigned exactly one output $f(W)$), the image $W_b$ is unique.

% \item \textbf{Fibres partition $\mathcal{P}(\mathbf{X})$.}
% For any $V\subseteq\mathbf{X}_b$ the fibre $\mathcal{W}_V=\{W\subseteq\mathbf{X}\mid f(W)=V\}$ collects exactly those tuple-worlds whose tuples lie precisely in the blocks indexed by $V$ (i.e. each block in $V$ contains at least one tuple of $W$ and no tuple of $W$ lies in a block outside $V$). Distinct $V$ produce disjoint fibres, and every tuple-world $W$ lies in the fibre of $f(W)$, hence the family $\{\mathcal{W}_V\}_{V\subseteq\mathbf{X}_b}$ is a partition of $\mathcal{P}(\mathbf{X})$.

% \item \textbf{Lifting of semantics.}
% Start from the tuple-level possible-world expansion from your semantics:
%   \begin{align*}
%   &[\mathdutchcal{u}\oslash\mathdutchcal{v}]_{\mathrm{op}}
% =
% \bigoplus_{W\subseteq\mathbf{X}}
%   \Gamma(W),
%     \\ &\text{where }\Gamma(W)
% \coloneqq
%   \Bigl(\bigotimes_{W\cap\mathrm{supp}(\mathdutchcal{u})}\mathbf{x}^{(K)}\Bigr)
%   \otimes
%   \Bigl(\bigotimes_{W\cap\mathrm{supp}(\mathdutchcal{v})}\mathbf{x}^{(K)}\Bigr)
%   \otimes
%   \chi_{\mathrm{op}}\!\Bigl(\bigplus_{M,W\cap\mathrm{supp}(\mathdutchcal{u})}\mathbf{x}^{(M)},
%                           \bigplus_{M,W\cap\mathrm{supp}(\mathdutchcal{v})}\mathbf{x}^{(M)}\Bigr)
%   \otimes
%   \Phi_{W}.
% \end{align*}
% Partition the outer sum according to the fibres of $f$:
% \[
% \bigoplus_{W\subseteq\mathbf{X}} \Gamma(W)
% =
% \bigoplus_{V\subseteq\mathbf{X}_b}\ \bigoplus_{W\in\mathcal{W}_V} \Gamma(W).
% \]
% This is merely a reorganization of the sum using the partition $\{\mathcal{W}_V\}$ established above.

% It remains to show that each inner sum $\bigoplus_{W\in\mathcal{W}_V}\Gamma(W)$ can be expressed in terms of block-level annotations
% $\mathbf{x}_B^{(K)}$ and $\mathbf{x}_B^{(M)}$. By the definitions
% \[
% \mathbf{x}_B^{(K)}=\bigoplus_{\mathbf{x}\in B}\mathbf{x}^{(K)}
% \qquad\text{and}\qquad
% \mathbf{x}_B^{(M)}=\bigplus_{M,\;\mathbf{x}\in B}\mathbf{x}^{(M)},
% \]
% the product over all tuple-level annotations in $W\cap\mathrm{supp}(\mathdutchcal{u})$
% can be regrouped block-wise. More precisely, because the blocks are disjoint,
% for $W\in\mathcal{W}_V$ the set $W\cap\mathrm{supp}(\mathdutchcal{u})$ is equal to
% \[
% \bigcup_{B\in V}\bigl(B\cap\mathrm{supp}(\mathdutchcal{u})\bigr),
% \]
% and therefore
% \[
% \bigotimes_{W\cap\mathrm{supp}(\mathdutchcal{u})}\mathbf{x}^{(K)}
% =
% \bigotimes_{B\in V}
%   \Bigl(\bigotimes_{\mathbf{x}\in B\cap\mathrm{supp}(\mathdutchcal{u})}\mathbf{x}^{(K)}\Bigr).
% \]
% Applying the semiring addition $\oplus$ inside each block (which is how we define $\mathbf{x}_B^{(K)}$)
% and using distributivity in the $m$-semiring,
% the inner combination over all tuple-worlds $W$ mapping to the same block-world $V$ collapses to an expression
% involving only the block-level annotations and block-level aggregate values.
% Analogous regrouping applies to the $M$-sums used inside $\chi_{\mathrm{op}}$.

% Hence each inner sum $\bigoplus_{W\in\mathcal{W}_V}\Gamma(W)$ can be rewritten as a block-level term of the form
% \[
% \Bigl(\!\bigotimes_{B\in V\cap\mathrm{supp}(\widehat{\mathdutchcal{u}})} \mathbf{x}_B^{(K)}\Bigr)
% \otimes
% \Bigl(\!\bigotimes_{B\in V\cap\mathrm{supp}(\widehat{\mathdutchcal{v}})} \mathbf{x}_B^{(K)}\Bigr)
% \otimes
% \widehat{\chi}_{\mathrm{op}}\!\Bigl(\bigplus_{M,B\in V\cap\mathrm{supp}(\widehat{\mathdutchcal{u}})}\mathbf{x}_B^{(M)},
%                                 \bigplus_{M,B\in V\cap\mathrm{supp}(\widehat{\mathdutchcal{v}})}\mathbf{x}_B^{(M)}\Bigr)
% \otimes
% \widehat{\Phi}_{V},
% \]
% where $\widehat{\chi}_{\mathrm{op}}$ tests the block-level aggregated quantities and $\widehat{\Phi}_{V}$
% is the block-level counterpart of the outside-world mask. Substituting these block-level terms back into the outer sum yields the claimed block-level expression.

% This completes the proof.

% \end{enumerate}
% \end{proof}

% \begin{remark}

% \begin{itemize}
%   \item The partition (disjointness) hypothesis on the blocks is crucial for the simple form of the map $f$ and the algebraic regrouping. If blocks overlap (e.g. in certain storage/replication layouts) the mapping still exists but the algebraic lifting requires careful duplication-accounting.
%   \item The equalities above are algebraic reorganisations inside the $m$-semiring and the monoid $(M,+_M)$. From an implementation viewpoint this is precisely why block-level possible-worlds can be used as a compact surrogate for tuple-level worlds, and why lazy expansion (reconstructing tuple-level annotations inside a block on demand) is sound: the block-level expression subsumes (by the fibres) the contributions of all tuple-level worlds lying under a given block-world.
% \end{itemize}
% \end{remark}
