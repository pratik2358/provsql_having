\documentclass[10pt,a4paper]{scrartcl}
\usepackage[left=1cm, right=1cm]{geometry}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{mathrsfs}
\usepackage{csquotes}
\usepackage{listings}
\usepackage{minted}
\usepackage[bb=boondox]{mathalfa}
\usepackage{amsthm}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem*{remark}{Remark}
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\newtheorem{proposition}[theorem]{Proposition}
\theoremstyle{remark}
\DeclareMathAlphabet{\mathdutchcal}{U}{dutchcal}{m}{n}
\SetMathAlphabet{\mathdutchcal}{bold}{U}{dutchcal}{b}{n}
\DeclareMathAlphabet{\mathdutchbcal}{U}{dutchcal}{b}{n}
\newcommand{\dq}[1]{\text{\enquote{#1}}}
\newcommand{\op}{\hspace{0.1cm}\mathsf{op}\hspace{0.1cm}}
\makeatletter
\newcommand{\bigplus}{%
  \DOTSB\mathop{\mathpalette\mattos@bigplus\relax}\slimits@
}
\newcommand\mattos@bigplus[2]{%
  \vcenter{\hbox{%
    \sbox\z@{$#1\sum$}%
    \resizebox{!}{0.9\dimexpr\ht\z@+\dp\z@}{\raisebox{\depth}{$\m@th#1+$}}%
  }}%
  \vphantom{\sum}%
}
\newcommand{\mline}[1]{%
  \begin{multiline}
    #1
  \end{multiline}
}
\newcommand{\llbracket}{[\![}
\newcommand{\rrbracket}{]\!]}
\makeatother

\begin{document}

\subsection*{Counting Semiring}

Let
\[
  \mathcal{N} = (\mathbb{N},+,\cdot,0,1)
\]
be the \emph{counting semiring}, and equip it with the \emph{monus} (truncated subtraction)
\[
  a \ominus b =\max(a - b,0).
\]

On a relation \(T\) with annotations \(b_1,\dots,b_n\in\mathbb{N}\), consider the two queries of 
“\(\mathrm{COUNT}(*) = c\)” exactly as before:

\begin{minted}[fontsize=\small]{sql}
SELECT DISTINCT 1
  FROM T
 HAVING COUNT(*) = c;
\end{minted}

Its provenance in \(\mathcal{N}\) becomes
\[
  q(T)
  =
  \bigoplus_{W}
    \Bigl(\bigotimes_{i\in W\cap T}b_i\Bigr)\otimes\chi_{=}\Bigl({\bigplus_{\mathbb{N}}}_{i\in W\cap T} 1, c\Bigr)\otimes\Bigl(1 \ominus \bigl(\bigoplus_{j\in W\cap T}b_j\bigr)\Bigr)
  =
  \sum_{W\subseteq T}
    \Bigl(\prod_{i\in W\cap T}b_i\cdot\bigl(1\ominus\sum_{j\in W\cap T}b_i\bigr)\Bigr).
\]

\begin{minted}[fontsize=\small]{sql}
SELECT DISTINCT 1
  FROM T AS a_1
  JOIN T AS a_2 ON a_1.id<a_2.id
  … JOIN T AS a_c ON a_{c-1}.id<a_c.id
EXCEPT
SELECT DISTINCT 1
  FROM T AS b_1
  JOIN T AS b_2 ON b_1.id<b_2.id
  … JOIN T AS b_{c+1} ON b_c.id<b_{c+1}.id;
\end{minted}

Its provenance is
\[
  q'(T)
  =
  \Bigl(\sum_{\substack{t\subseteq[n],\\|t|=c}}\prod_{i\in t}b_i\Bigr)
  \ominus
  \Bigl(\sum_{\substack{t'\subseteq[n],\\|t'|=c+1}}\prod_{i\in t'}b_i\Bigr).
\]

\begin{proposition}
There exist annotations and a choice of \(c\) for which
\(q'(T)\neq q(T)\)
in the counting semiring \(\mathcal{N}\).
\end{proposition}

\begin{proof}
Take \(\lvert T\rvert=2\), \(c=1\), and annotations
\[
  b_1 = 1,\quad b_2 = 2.
\]
Then the only world contributing to \(q(T)\) is \(w(1)=w(2)=1\), since any world with an absent tuple gives
\((1\ominus\sum_{w(i)=0}b_i)=0\).  Hence
\[
  q(T)
  = (1\cdot2)\bigl(1\ominus0\bigr)
  = 2.
\]
On the other hand,
\[
  q'(T)
  = (b_1+b_2)\ominus(b_1\cdot b_2)
  = (1+2)\ominus(1\cdot2)
  = 3\ominus2
  = 1.
\]
Thus \(q'(T)=1\neq2=q(T)\).
\end{proof}

\bigskip
\noindent\textbf{Discussion of the Failure}

\begin{itemize}
  \item In \(\mathcal{N}\), addition and multiplication are \emph{not} idempotent, nor is monus an involution.
  \item The Boolean proof relied on \emph{absorptivity} and pointwise idempotence (\(1\vee1=1\)), which fail for \(\mathbb{N}\).
  \item Consequently the “join‐except” provenance
    \(\sum_{|t|=c}-\sum_{|t'|=c+1}\)
    does \emph{not} coincide with the summation over worlds
    \(\sum_{w}\prod_{w(i)=1}n_i\cdot(1\ominus\sum_{w(i)=0}n_i)\).
\end{itemize}

\end{document}