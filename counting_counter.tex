\documentclass{article}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{minted}
\usepackage{geometry}
\geometry{margin=1in}

\newtheorem{proposition}{Proposition}

\begin{document}

\subsection*{Counting Semiring}

Let
\[
  \mathcal{N} = (\mathbb{N},+,\cdot,0,1)
\]
be the \emph{counting semiring}, and equip it with the \emph{monus} (truncated subtraction)
\[
  a \ominus b =\max(a - b,0).
\]

On a relation \(T\) with annotations \(b_1,\dots,b_n\in\mathbb{N}\), consider the two queries of 
“\(\mathrm{COUNT}(*) = c\)” exactly as before:

\begin{minted}[fontsize=\small]{sql}
SELECT DISTINCT 1
  FROM T
 HAVING COUNT(*) = c;
\end{minted}

Its provenance in \(\mathcal{N}\) becomes
\[
  q(T)
  =
  \bigoplus_{w:\{1,\dots,n\}\to\{0,1\}}
    \Bigl(\bigotimes_{w(i)=1}b_i
           \otimes
           \bigl(1\ominus\bigoplus_{w(i)=0}b_i\bigr)
    \Bigr)
  =
  \sum_{w}
    \Bigl(\prod_{w(i)=1}b_i\cdot\bigl(1\ominus\sum_{w(i)=0}b_i\bigr)\Bigr).
\]

\begin{minted}[fontsize=\small]{sql}
SELECT DISTINCT 1
  FROM T AS a_1
  JOIN T AS a_2 ON a_1.id<a_2.id
  … JOIN T AS a_c ON a_{c-1}.id<a_c.id
EXCEPT
SELECT DISTINCT 1
  FROM T AS b_1
  JOIN T AS b_2 ON b_1.id<b_2.id
  … JOIN T AS b_{c+1} ON b_c.id<b_{c+1}.id;
\end{minted}

Its provenance is
\[
  q'(T)
  =
  \Bigl(\sum_{\substack{t\subseteq[n],\\|t|=c}}\prod_{i\in t}b_i\Bigr)
  \ominus
  \Bigl(\sum_{\substack{t'\subseteq[n],\\|t'|=c+1}}\prod_{i\in t'}b_i\Bigr).
\]

\begin{proposition}
There exist annotations and a choice of \(c\) for which
\(q'(T)\neq q(T)\)
in the counting semiring \(\mathcal{N}\).
\end{proposition}

\begin{proof}
Take \(\lvert T\rvert=2\), \(c=1\), and annotations
\[
  b_1 = 1,\quad b_2 = 2.
\]
Then the only world contributing to \(q(T)\) is \(w(1)=w(2)=1\), since any world with an absent tuple gives
\((1\ominus\sum_{w(i)=0}b_i)=0\).  Hence
\[
  q(T)
  = (1\cdot2)\bigl(1\ominus0\bigr)
  = 2.
\]
On the other hand,
\[
  q'(T)
  = (b_1+b_2)\ominus(b_1\cdot b_2)
  = (1+2)\ominus(1\cdot2)
  = 3\ominus2
  = 1.
\]
Thus \(q'(T)=1\neq2=q(T)\).
\end{proof}

\bigskip
\noindent\textbf{Discussion of the Failure}

\begin{itemize}
  \item In \(\mathcal{N}\), addition and multiplication are \emph{not} idempotent, nor is monus an involution.
  \item The Boolean proof relied on \emph{absorptivity} and pointwise idempotence (\(1\vee1=1\)), which fail for \(\mathbb{N}\).
  \item Consequently the “join‐except” provenance
    \(\sum_{|t|=c}-\sum_{|t'|=c+1}\)
    does \emph{not} coincide with the summation over worlds
    \(\sum_{w}\prod_{w(i)=1}n_i\cdot(1\ominus\sum_{w(i)=0}n_i)\).
\end{itemize}

\end{document}