\documentclass{article}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{minted}
\usepackage{geometry}
\geometry{margin=1in}

\newtheorem{proposition}{Proposition}

\begin{document}

\subsection*{Boolean‐Function Semiring}

Let \(X\) be a set of worlds.  Define the \emph{Boolean‐function semiring}
\[
  \mathcal{B}(X)
  = \bigl(\{f : X \to \{0,1\}\},\oplus,\otimes,0_{\mathcal{B}},1_{\mathcal{B}}\bigr),
\]
where for all \(f,g: X\to\{0,1\}\) and \(x\in X\):
\[
  (f\oplus g)(x) = f(x)\vee g(x),
  \quad
  (f\otimes g)(x) = f(x)\wedge g(x),
\]
and
\[
  0_{\mathcal{B}}(x)=0,\qquad 1_{\mathcal{B}}(x)=1.
\]
Define the \emph{monus} (pointwise ``and‐not'') by
\[
  (f\ominus g)(x)
  = f(x)\wedge\neg\bigl(g(x)\bigr),
  \quad
  \text{i.e.\ }f\ominus g = f\otimes(\neg g).
\]

\medskip
On a relation \(T\) with Boolean‐function annotations \(b_1,\dots,b_n\in\mathcal{B}(X)\), consider:

\begin{minted}[fontsize=\small]{sql}
SELECT DISTINCT 1
  FROM T
 HAVING COUNT(*) = c;
\end{minted}

Its provenance is
\[
  q(T)
  = \bigoplus_{w:\{1,\dots,n\}\to\{0,1\}}
    \Bigl(\bigotimes_{w(i)=1}b_i
           \otimes
           \bigl(1_{\mathcal{B}}\ominus(\!\bigoplus_{w(i)=0}b_i)\bigr)
    \Bigr).
\]

\begin{minted}[fontsize=\small]{sql}
SELECT DISTINCT 1
  FROM T AS a1
  JOIN T AS a2 ON a1.id<a2.id 
  … JOIN T AS a_c ON a_{c-1}.id<a_c.id
EXCEPT
SELECT DISTINCT 1
  FROM T AS b1
  JOIN T AS b2 ON b1.id<b2.id 
  … JOIN T AS b_{c+1} ON b_{c}.id<b_{c+1}.id;
\end{minted}

Its provenance is
\[
  q'(T)
  = \Bigl(\!\bigoplus_{t\subseteq[n],|t|=c}\!\bigotimes_{i\in t}b_i\Bigr)
    \ominus
    \Bigl(\!\bigoplus_{t'\subseteq[n],|t'|=c+1}\!\bigotimes_{i\in t'}b_i\Bigr).
\]

\begin{proposition}
For all \(T\), \(q'(T)=q(T)\) in \(\mathcal{B}(X)\).
\end{proposition}

\begin{proof}
Set
\[
  A = \bigoplus_{|t|=c}\bigotimes_{i\in t}b_i,
  \quad
  B = \bigoplus_{|t'|=c+1}\bigotimes_{i\in t'}b_i.
\]
Then by definition of \(\ominus\),
\[
  q'(T) = A \ominus B = A \otimes (\neg B).
\]
But all operations in \(\mathcal{B}(X)\) are \emph{pointwise}.  Hence for each \(x\in X\),
\[
  q'(T)(x)
  = A(x)\wedge\neg\bigl(B(x)\bigr),
\]
and the standard Boolean‐semiring argument shows
\[
  A(x)\wedge\neg B(x)
  = \bigoplus_{w}\Bigl(\bigotimes_{w(i)=1}b_i(x)
                      \otimes
                      (1\ominus\bigoplus_{w(i)=0}b_i(x))\Bigr)
  = q(T)(x).
\]
Since this holds for every \(x\), \(q'(T)=q(T)\) as functions in \(\mathcal{B}(X)\).
\end{proof}

\bigskip
\noindent\textbf{Explanation of Changes}
\begin{itemize}
  \item \emph{Domain}: Upgraded from \(\{0,1\}\) to all Boolean‐valued functions \(\mathcal{B}(X)\).
  \item \emph{Operations}: \(\oplus,\otimes,\ominus\) act \emph{pointwise} by \(\vee,\wedge,\wedge\neg\).
  \item \emph{Proof strategy}: Equality of provenance functions follows by verifying equality at each world \(x\), reducing to the usual Boolean‐semiring proof.
\end{itemize}

\end{document}
