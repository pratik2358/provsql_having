\section{Testing provenance semantics across different $m-$semirings of interest}
We test our possible-world semantics on different $m-$semirings of interest. We examine whether our semantics make 
sense for absorptive $m-$semirings like the Boolean semiring and the semiring of Boolean functions on Query~\ref{q:agg} which involves very simple aggregate comparison on an imaginary relation $T$ with 
$n$ tuples. We compare the provenance given by our possible-world 
semantics for Query~\ref{q:agg} with the provenance computation for Query~\ref{q:agg}'s \textsc{JOIN}-equivalent version - Query~\ref{q:join}.   

\begin{listing}[h!]
  \begin{minted}[frame=single,fontsize=\small]{sql}\label{q:agg}
SELECT DISTINCT 1
  FROM T
 HAVING COUNT(*) = c;
\end{minted}
\end{listing}
\begin{listing}[h!]
\begin{minted}[frame=single,fontsize=\small]{sql}\label{q:join}
SELECT DISTINCT 1
  FROM T AS a1
  JOIN T AS a2 ON a1.id <  a2.id
  JOIN T AS a3 ON a2.id <  a3.id
  -- ...
  JOIN T AS a_c ON a_{c-1}.id < a_c.id

EXCEPT

SELECT DISTINCT 1
  FROM T AS b1
  JOIN T AS b2 ON b1.id <  b2.id
  JOIN T AS b3 ON b2.id <  b3.id
  -- ...
  JOIN T AS b_{c+1} ON b_c.id < b_{c+1}.id;
\end{minted}
\end{listing}
We also provide a case study analysis on $m-$semirings where our semantics 
provide different explanations from the provenance semamntics of the join equivalent query.
\subsection{Boolean Semiring}
$$B = (\{0,1\}, \lor, \land, 0, 1)$$
$$\lor : \text{Standard logical OR}$$
$$\land : \text{Standard logical AND}$$
$$0 : \text{Boolean zero}$$
$$1 : \text{Boolean one}$$
\[
\ominus: \text{Monus for Boolean Semiring} \quad a \ominus b := a \land \neg b
\]
Now we take a query as below on a relation $T$ with $n$ tuples:

This returns 1 if the relation $T$ has exactly $c$ tuples, and 0 otherwise.

In possible world semantics, let $w: \{1,2,\dots,m\} \mapsto \{0,1\}$.

The provenance of this query can be expressed as follows:

$$q(T) = \bigoplus_{w}\left(\bigotimes_{w(i)=1}b_i\otimes\left(\mathbb{1}\ominus(\bigoplus_{w(i) =0}b_i)\right)\right)$$

On the other hand, its equivalent join query will be as follows:

The provenance of this query can be expressed as follows:
\[
q'(T) = \bigoplus_{\substack{t\subseteq T \\ |t| = c}}\left(\bigotimes_{\substack{b_i\in t}}b_i\right) \ominus \bigoplus_{\substack{t'\subseteq T \\ |t'| = c+1}}\left(\bigotimes_{\substack{b_i\in t'}}b_i\right)
\]

\begin{proof}
Define
\[
A \;=\; \bigvee_{\lvert t\rvert = c}\;\bigwedge_{i\in t} b_i,
\qquad
B \;=\; \bigvee_{\lvert t'\rvert = c+1}\;\bigwedge_{i\in t'} b_i.
\]
Since in the Boolean semiring \(\oplus=\vee\), \(\otimes=\wedge\) and
\(\;r\ominus s = r\wedge\neg s\), we have
\[
q'(T)
= A \ominus B
= A \wedge \neg B.
\]
Expand step by step:
\begin{align*}
q'(T)
&= \Bigl(\!\bigvee_{\lvert t\rvert = c}\!\bigwedge_{i\in t}b_i\Bigr)
   \;\wedge\;
   \neg\Bigl(\!\bigvee_{\lvert t'\rvert = c+1}\!\bigwedge_{i\in t'}b_i\Bigr)\\[6pt]
&= \Bigl(\!\bigvee_{\lvert t\rvert = c}\!\bigwedge_{i\in t}b_i\Bigr)
   \;\wedge\;
   \Bigl(\!\bigwedge_{\lvert t'\rvert = c+1}\!\neg\bigl(\!\bigwedge_{i\in t'}b_i\bigr)\Bigr)\\[6pt]
&= \bigvee_{\lvert t\rvert = c}
    \Bigl(
      \bigwedge_{i\in t}b_i
      \;\wedge\;
      \bigwedge_{|t'|=c+1}\!\neg\bigl(\!\bigwedge_{i\in t'}b_i\bigr)
    \Bigr).
\end{align*}

\textbf{Key simplification.}  Fix a particular \(t\) with \(\lvert t\rvert=c\).  Consider
\[
\bigwedge_{\substack{t'\subseteq[m]\\|t'|=c+1}}
\neg\Bigl(\!\bigwedge_{i\in t'}b_i\Bigr).
\]
- For each \(j\notin t\), the subset \(t'=t\cup\{j\}\) yields
  \(\neg\bigl(b_j\wedge\bigwedge_{i\in t}b_i\bigr)=\neg b_j\).  
- Any other \(t'\) also contains some \(j\notin t\), so its factor
  \(\neg(\bigwedge_{i\in t'}b_i)\) can be written as
  \(\neg b_j\vee Y\).  

with \(x=\neg b_j\), each such pair of factors collapses to \(\neg b_j\).  Hence the entire
AND reduces to
\(\bigwedge_{j\notin t}\neg b_j\).

Substituting back gives
\[
q'(T)
=\bigvee_{\lvert t\rvert = c}
\Bigl(\,\bigwedge_{i\in t}b_i
       \;\wedge\;
       \bigwedge_{j\notin t}\neg b_j
\Bigr)
=\;q(T),
\]
as required.
\end{proof}
\subsection{Boolean‐Function Semiring}

Let \(X\) be a set of worlds.  
Define the \emph{Boolean‐function m‐semiring}:
\[
  \mathcal{B}(X)
  = \bigl(\{f : X \to \{0,1\}\},\oplus,\otimes,0_{\mathcal{B}},1_{\mathcal{B}},\delta,\ominus\bigr),
\]
where, for \(f,g : X\to\{0,1\},\;x\in X\):
\[
  (f\oplus g)(x)=f(x)\vee g(x), \quad (f\otimes g)(x)=f(x)\wedge g(x),
\]
\[
  (f\ominus g)(x)=f(x)\wedge\neg g(x),\quad \delta(f)(x)=
  \begin{cases}
  1 & \text{if } f(x)=1,\\
  0 & \text{otherwise.}
  \end{cases}
\]
Here \(0_{\mathcal{B}}\) and \(1_{\mathcal{B}}\) are the constant‐0 and constant‐1 functions.  
Let the additive monoid of aggregate values be \((M,+_M,\mathbb{0}_M)=(\mathbb{N},+,0)\).

---

\paragraph{Aggregation Semantics.}  
An aggregation expression is
\[
\mathbf{a}=\bigoplus_{\mathcal{M},i}(a_i^{(K)},a_i^{(M)}),
\]
with \(a_i^{(K)}\in\mathcal{B}(X)\) the Boolean provenance annotation and \(a_i^{(M)}\in\mathbb{N}\) its numeric monoid value.  

Given two aggregations \(\mathbf{u},\mathbf{v}\), their comparison is:
\begin{multline}
[\mathbf{u}\oslash \mathbf{v}]_{\mathrm{op}}=
\bigoplus_{S,T}
\Biggl(
\Bigl(\bigotimes_{i\in S}u_i^{(K)}\Bigr)
\otimes
\Bigl(\bigotimes_{j\in T}v_j^{(K)}\Bigr) \\
\otimes\;\chi_{\mathrm{op}}\bigl(\mathrm{val}_\mathbf{u}(S),\mathrm{val}_\mathbf{v}(T)\bigr)
\otimes
\Biggl(1_{\mathcal{B}}\ominus\Bigl(\bigoplus_{i\notin S}u_i^{(K)}\;\oplus\;\bigoplus_{j\notin T}v_j^{(K)}\Bigr)\Biggr)
\Biggr),
\end{multline}
where
\[
\chi_{\mathrm{op}}(x,y)=
\begin{cases}
1_{\mathcal{B}} & \text{if } x\;\mathit{op}\; y, \\
0_{\mathcal{B}} & \text{otherwise,}
\end{cases}
\]
and
\[
\mathrm{val}_\mathbf{u}(S)=\sum_{i\in S}u_i^{(M)},\quad
\mathrm{val}_\mathbf{v}(T)=\sum_{j\in T}v_j^{(M)}.
\]

---

\paragraph{SQL Example.}  
On a relation \(T\) with Boolean annotations \(b_1,\dots,b_n\in\mathcal{B}(X)\):
Its provenance is
\[
q(T)=\bigoplus_{w:\{1,\dots,n\}\to\{0,1\}}
\Bigl(
\bigotimes_{w(i)=1}b_i
\;\otimes\;
(1_{\mathcal{B}}\ominus\bigoplus_{w(i)=0}b_i)
\Bigr).
\]

Its provenance is
\[
q'(T)=\Bigl(\!\bigoplus_{t\subseteq[n],|t|=c}\bigotimes_{i\in t}b_i\Bigr)
\ominus
\Bigl(\!\bigoplus_{t'\subseteq[n],|t'|=c+1}\bigotimes_{i\in t'}b_i\Bigr).
\]

---

\begin{proposition}
For all \(T\), \(q'(T)=q(T)\) in \(\mathcal{B}(X)\).
\end{proposition}

\begin{proof}
Define
\[
A=\bigoplus_{|t|=c}\bigotimes_{i\in t}b_i, \quad
B=\bigoplus_{|t'|=c+1}\bigotimes_{i\in t'}b_i.
\]
Then
\[
q'(T)=A\ominus B=A\otimes(\neg B).
\]
All operations are pointwise in \(\mathcal{B}(X)\), so for each world \(x\in X\):
\[
q'(T)(x)=A(x)\wedge\neg B(x).
\]
This matches the per-world condition in the $\oslash$-semantics of $q(T)$, so $q'(T)=q(T)$.
\end{proof}

\noindent\textbf{Explanation.}
\begin{itemize}
  \item Domain: Boolean functions over $X$, not just $\{0,1\}$.  
  \item Operations: $\oplus,\otimes,\ominus$ act pointwise as $\vee,\wedge,\wedge\neg$.  
  \item Because $\mathcal{B}(X)$ is idempotent and absorptive, join-except coincides with world-sum provenance.
\end{itemize}              
\input{homomorphisms.tex}

\subsection{counting semiring}
\begin{toappendix}

\section*{Counting Semiring Definition}

\[
k = (\mathbb{N}, \oplus, \otimes, 0, 1)
\]

where:

\[
\mathbb{N} = \{0, 1, 2, \dots\}
\]

\[
\begin{aligned}
\oplus &: \text{standard integer addition}, \\
\otimes &: \text{standard integer multiplication}, \\
0 &\in \mathbb{N} : \text{zero element}, \\
1 &\in \mathbb{N} : \text{one element}.
\end{aligned}
\]

---

\subsection*{Additional Operators}

\paragraph{Monus (Truncated Subtraction):}
\[
a \ominus b = 
\begin{cases}
0, & a \le b, \\
a - b, & a > b.
\end{cases}
\]

\paragraph{Delta Function:}
\[
\delta(a) = 
\begin{cases}
0, & a = 0, \\
1, & a > 0.
\end{cases}
\qquad
\delta : k \mapsto k
\]
\[
\delta(0_k) = 0_k, \quad \delta(n \cdot 1_k) = 1_k
\]

---

\subsection*{Counting Semiring Properties}

\paragraph{1. Additive Monoid}
\[
\begin{aligned}
(a \oplus b) \oplus c &= a \oplus (b \oplus c) && \text{(Associativity)} \\
a \oplus b &= b \oplus a && \text{(Commutativity)} \\
a \oplus 0 &= a && \text{(Identity)}
\end{aligned}
\]

\paragraph{2. Multiplicative Monoid}
\[
\begin{aligned}
(a \otimes b) \otimes c &= a \otimes (b \otimes c) && \text{(Associativity)} \\
a \otimes b &= b \otimes a && \text{(Commutativity)} \\
a \otimes 1 &= a && \text{(Identity)}
\end{aligned}
\]

\paragraph{3. Distributivity}
\[
\begin{aligned}
a \otimes (b \oplus c) &= (a \otimes b) \oplus (a \otimes c) && \text{(Left Distributivity)} \\
(a \oplus b) \otimes c &= (a \otimes c) \oplus (b \otimes c) && \text{(Right Distributivity)}
\end{aligned}
\]

\paragraph{4. Absorption}
\[
a \otimes 0 = 0 \otimes a = 0
\]

\paragraph{5. Monus Properties}
For all \( a, b \in k \):
\[
\begin{aligned}
(a \ominus b) \oplus b &= a, && \text{if } a \ge b, \\
a \ominus 0 &= a, \\
0 \ominus a &= 0.
\end{aligned}
\]

\paragraph{6. Semimodule Operation}
\[
\begin{aligned}
a \otimes (b * m) &= (a \otimes b) * m && \text{(Associativity with multiplication)} \\
1 * m &= m && \text{(Identity)} \\
0 * m &= 0 && \text{(Absorption)}
\end{aligned}
\]

\paragraph{7. Other Properties}
\[
\delta(u) \otimes [[u \oslash v]]_{\textit{op}} =
\begin{cases}
1, & \text{if } (u \ \textit{op}\ v) \text{ holds in } \mathbb{N}, \\
0, & \text{otherwise.}
\end{cases}
\]

---

\subsection*{Example: COUNT Aggregation with HAVING Clause}

For a COUNT(*) aggregate, let:
\[
f = \bigoplus_{g \in \text{group}} 1
\]

Then to filter using a HAVING condition (e.g., \( f > C \)):

\[
\delta(f) \otimes [[f \oslash C]]_{>} =
\begin{cases}
1, & \text{if } f > C \text{ in } \mathbb{N}, \\
0, & \text{otherwise.}
\end{cases}
\]

\end{toappendix}


Let
\[
  \mathcal{N} = (\mathbb{N},+,\cdot,0,1)
\]
be the \emph{counting semiring}, and equip it with the \emph{monus} (truncated subtraction)
\[
  a \ominus b =\max(a - b,0).
\]

On a relation \(T\) with annotations \(b_1,\dots,b_n\in\mathbb{N}\), consider the two queries of 
“\(\mathrm{COUNT}(*) = c\)” exactly as before:



Its provenance in \(\mathcal{N}\) becomes
\[
  q(T)
  =
  \bigoplus_{W}
    \Bigl(\bigotimes_{i\in W\cap T}b_i\Bigr)\otimes\chi_{=}\Bigl({\bigplus_{\mathbb{N}}}_{i\in W\cap T} 1, c\Bigr)\otimes\Bigl(1 \ominus \bigl(\bigoplus_{j\in W\cap T}b_j\bigr)\Bigr)
  =
  \sum_{W\subseteq T}
    \Bigl(\prod_{i\in W\cap T}b_i\cdot\bigl(1\ominus\sum_{j\in W\cap T}b_i\bigr)\Bigr).
\]

Its provenance is
\[
  q'(T)
  =
  \Bigl(\sum_{\substack{t\subseteq[n],\\|t|=c}}\prod_{i\in t}b_i\Bigr)
  \ominus
  \Bigl(\sum_{\substack{t'\subseteq[n],\\|t'|=c+1}}\prod_{i\in t'}b_i\Bigr).
\]

\begin{proposition}
There exist annotations and a choice of \(c\) for which
\(q'(T)\neq q(T)\)
in the counting semiring \(\mathcal{N}\).
\end{proposition}

\begin{proof}
Take \(\lvert T\rvert=2\), \(c=1\), and annotations
\[
  b_1 = 1,\quad b_2 = 2.
\]
Then the only world contributing to \(q(T)\) is \(w(1)=w(2)=1\), since any world with an absent tuple gives
\((1\ominus\sum_{w(i)=0}b_i)=0\).  Hence
\[
  q(T)
  = (1\cdot2)\bigl(1\ominus0\bigr)
  = 2.
\]
On the other hand,
\[
  q'(T)
  = (b_1+b_2)\ominus(b_1\cdot b_2)
  = (1+2)\ominus(1\cdot2)
  = 3\ominus2
  = 1.
\]
Thus \(q'(T)=1\neq2=q(T)\).
\end{proof}

\bigskip
\noindent\textbf{Discussion of the Failure}

\begin{itemize}
  \item In \(\mathcal{N}\), addition and multiplication are \emph{not} idempotent, nor is monus an involution.
  \item The Boolean proof relied on \emph{absorptivity} and pointwise idempotence (\(1\vee1=1\)), which fail for \(\mathbb{N}\).
  \item Consequently the “join‐except” provenance
    \(\sum_{|t|=c}-\sum_{|t'|=c+1}\)
    does \emph{not} coincide with the summation over worlds
    \(\sum_{w}\prod_{w(i)=1}n_i\cdot(1\ominus\sum_{w(i)=0}n_i)\).
\end{itemize}



