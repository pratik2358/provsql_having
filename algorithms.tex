\section{Implementation}
Using our semantics, we obtain the expression $[u\oslash v]$. Without loss of generality, 
for every constant value of the aggregation expression $v=C$, we can rewrite this expression 
as $[u\oslash C]_{\mathrm{op}}$. We now present a dynamic programming algorithm~\ref{alg:dp_subsets} to compute the set of subsets 
that satisfy the condition imposed by the operator $\mathrm{op}\in\{=,>,<,\ge,\le\}$ with 
respect to the constant $C$. Using this set of subsets, we can compute the probability of 
$[u\oslash C]_{\mathrm{op}}$ 
by using the Algorithm~\ref{alg:probability}.
\begin{algorithm}
  \label{alg:dp_subsets}
  \caption{DP algorithm for $[\mathdutchcal{u}\oslash C]_{\mathrm{op}}$ (covers $=,>,<,\ge,\le$)}
  \begin{algorithmic}[1]
    \REQUIRE a dictionary $A \leftarrow \mathrm{supp}(\mathdutchcal{u})$, a constant $C \in M$, and an operator $\mathrm{op}\in\{=,>,<,\ge,\le\}$
    \ENSURE a list $\mathcal{R}$ of subsets of $A$, s.t.\ $\forall R \in \mathcal{R}$, $\ \sum_{\mathbf{x}\in R}\mathbf{x}^{(M)}\ \mathrm{op}\ C$

    \IF{$\mathrm{op}\in\{>,\ge\}$}
      \STATE $T \gets \sum_{\mathbf{x}\in A}\mathbf{x}^{(M)}$ \COMMENT{max possible sum}
      \STATE $J \gets T$
    \ELSIF{$\mathrm{op}=<$}
      \STATE $J \gets C-1$
    \ELSE
      \STATE $J \gets C$ \COMMENT{$\mathrm{op}\in\{=,\le\}$}
    \ENDIF

    \STATE Initialize $dp[0] \leftarrow \{\emptyset\}$
    \FOR{$j \gets 1$ \TO $J$}
      \STATE $dp[j] \leftarrow \emptyset$
    \ENDFOR

    \FOR{$i \gets 1$ \TO $|A|$}
      \STATE $w \gets A^{(M)}[i]$, $g \gets A^{(K)}[i]$
      \FOR{$j \gets J, J-1, \dots, w$}
        \STATE $p \gets j - w$
        \IF{$dp[p] \neq \emptyset$}
          \FORALL{$S \in dp[p]$}
            \STATE append $S \cup \{g\}$ to $dp[j]$
          \ENDFOR
        \ENDIF
      \ENDFOR
    \ENDFOR

    \IF{$\mathrm{op} = =$}
      \STATE $\mathcal{R} \leftarrow dp[C]$
    \ELSIF{$\mathrm{op} = >$}
      \STATE $\mathcal{R} \leftarrow \bigcup_{j=C+1}^{J} dp[j]$
    \ELSIF{$\mathrm{op} = <$}
      \STATE $\mathcal{R} \leftarrow \bigcup_{j=1}^{C-1} dp[j]$
    \ELSIF{$\mathrm{op} = \ge$}
      \STATE $\mathcal{R} \leftarrow \bigcup_{j=C}^{J} dp[j]$
    \ELSE % \mathrm{op}=\le
      \STATE $\mathcal{R} \leftarrow \bigcup_{j=1}^{C} dp[j]$
    \ENDIF

    \STATE \RETURN $\mathcal{R}$
  \end{algorithmic}
\end{algorithm}


\begin{algorithm}
  \label{alg:probability}
  \caption{Probability computation for $[\mathdutchcal{u}\oslash C]_{\mathrm{op}}$}
  \begin{algorithmic}[1]
    \REQUIRE dictionary $A\leftarrow\mathrm{supp}(\mathdutchcal{u})$, constant $C\in M$, operator $\mathrm{op}$, and probabilities $p(g)$ for all $g\in\mathcal{G}$
    \ENSURE $\Pr\big([\mathdutchcal{u}\oslash C]_{\mathrm{op}}\big)$
    \STATE $\mathcal{R} \gets \textsc{DP-Subsets}(A,C,\mathrm{op})$ \COMMENT{Algorithm above}
    \STATE $P \gets 0$
    \FORALL{$S \in \mathcal{R}$}
      \STATE $\pi \gets 1$
      \FORALL{$g \in \mathcal{G}$}
        \IF{$g \in S$}
          \STATE $\pi \gets \pi \cdot p(g)$
        \ELSE
          \STATE $\pi \gets \pi \cdot (1 - p(g))$
        \ENDIF
      \ENDFOR
      \STATE $P \gets P + \pi$
    \ENDFOR
    \STATE \RETURN $P$
  \end{algorithmic}
\end{algorithm}

% \begin{table}[hbt]
%   \centering
%   \begin{tabular}{cc}
%     \toprule
%     operator & $\mathcal{R}$\\
%     \midrule
%     $=$ & $dp[C]$\\
%     $>$ & $\bigcup_{j=C+1}^{T} dp[j]$\\
%     $<$ & $\bigcup_{j=1}^{C-1} dp[j]$\\
%     $\geq$ & $\bigcup_{j=C}^{T} dp[j]$\\
%     $\leq$ & $\bigcup_{j=1}^{C} dp[j]$\\
%     \bottomrule
%   \end{tabular}
% \end{table}

\begin{algorithm}
  \label{alg:count-prov-comparisons}
  \caption{Provenance for \texttt{COUNT(*)} comparisons}
  \begin{algorithmic}[1]
    \REQUIRE Support set $A=\{a_1,\dots,a_n\}$ of tuple annotations; threshold $m$
    \ENSURE $\mathrm{Prov}(\texttt{COUNT(*)} \ge m)$, $\mathrm{Prov}(\texttt{COUNT(*)} \le m)$, $\mathrm{Prov}(\texttt{COUNT(*)} = m)$

    \STATE \textbf{Function} $\textsc{ProdSet}(S)$
    \STATE \hspace{1em} $p \gets \mathbf{1}$
    \FORALL{$x \in S$}
      \STATE \hspace{1em} $p \gets p \otimes x$
    \ENDFOR
    \STATE \hspace{1em} \textbf{return} $p$

    \STATE $P_{\ge m} \gets \mathbf{0}$
    \FORALL{$S \subseteq A$ such that $|S| = m$}
      \STATE $P_{\ge m} \gets P_{\ge m} \oplus \textsc{ProdSet}(S)$
    \ENDFOR

    \STATE $P_{\le m} \gets \mathbf{0}$
    \FORALL{$S \subseteq A$ such that $|S| = n-m$}
      \STATE $S' \gets \{\bar{x}\mid x\in S\}$
      \STATE $P_{\le m} \gets P_{\le m} \oplus \textsc{ProdSet}(S')$
    \ENDFOR

    \STATE $P_{=m} \gets P_{\ge m} \otimes P_{\le m}$

    \STATE \RETURN $(P_{\ge m}, P_{\le m}, P_{=m})$
  \end{algorithmic}
\end{algorithm}